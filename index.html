<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ± í•´ê²°ëƒ¥ëƒ¥ì´ ê³ ì–‘ì¹˜ â€“ ìŠ¤í‚¨/ì‚¬ìš´ë“œ/ë‚®ë°¤/íŒŒí‹°í´</title>
<style>
  :root{
    /* Day colors */
    --day1:#a1c4fd; --day2:#c2e9fb;
    /* Night colors */
    --night1:#232526; --night2:#414345;
    --card:#fff; --txt:#333; --sub:#555;
    --btn1:#ff9a9e; --btn2:#fecfef; --ok:#6dd5ed; --warn:#ffd166; --bad:#ef476f;
  }
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(135deg,var(--day1),var(--day2));
    font-family:"Pretendard","Noto Sans KR",system-ui,sans-serif; color:var(--txt);
    padding:24px; text-align:center; transition:background .6s ease;
    overflow-x:hidden; position:relative;
  }
  .stars{pointer-events:none; position:fixed; inset:0; opacity:0; transition:opacity .8s ease;}
  .star{position:absolute; width:2px; height:2px; background:#fff; border-radius:50%; opacity:.85}
  .is-night .stars{opacity:.65;}

  .app{background:var(--card); width:min(860px,94vw); border-radius:24px; box-shadow:0 10px 28px rgba(0,0,0,.15); padding:18px 16px}
  header{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:6px}
  h1{margin:6px 0 2px; font-size:1.5rem}
  .sub{color:var(--sub); font-size:.92rem; margin:2px 0 14px}
  .ctrls{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center}
  select, .chip{
    border:1px solid #e5e7eb; padding:8px 10px; border-radius:999px; background:#fff; font-weight:600;
  }
  .chip{cursor:pointer; user-select:none}
  .chip.active{background:linear-gradient(135deg,var(--btn1),var(--btn2)); border-color:transparent}

  .row{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:10px 0}
  button{
    border:0; padding:12px 16px; border-radius:999px; cursor:pointer; font-weight:700;
    background:linear-gradient(135deg,var(--btn1),var(--btn2)); color:#333; box-shadow:0 6px 14px rgba(0,0,0,.12); transition:transform .08s ease;
  }
  button:active{transform:translateY(1px)}
  .small{padding:8px 12px; font-weight:600; opacity:.9}
  .pill{background:linear-gradient(135deg,#d4fc79,#96e6a1)}
  .warn{background:linear-gradient(135deg,#ffd166,#ffe29a)}
  .danger{background:linear-gradient(135deg,#ef476f,#ff8fab); color:#fff}

  .pet{
    position:relative;
    display:flex; gap:14px; align-items:center; justify-content:center; padding:12px 10px; border-radius:18px;
    background:linear-gradient(180deg,#ffffff, #f7fbff); box-shadow:inset 0 1px 0 rgba(0,0,0,.04);
  }
  .avatar{width:110px; height:110px; display:grid; place-items:center; position:relative; overflow:visible}
  .face{font-size:3.6rem; line-height:1}
  .svgcat{width:110px; height:110px}
  .name{font-weight:700; font-size:1.05rem}
  .hint{font-size:.9rem; color:#666}

  .bars{display:grid; gap:10px; margin:14px 0}
  .bar{display:grid; grid-template-columns:92px 1fr auto; align-items:center; gap:8px; font-size:.95rem}
  .track{height:12px; background:#edf2f7; border-radius:999px; overflow:hidden}
  .fill{height:100%; width:50%; background:linear-gradient(90deg,var(--btn1),var(--btn2))}
  .val{min-width:56px; text-align:right; font-variant-numeric:tabular-nums}

  .grid{display:grid; grid-template-columns:1fr; gap:12px}
  .card{background:#fff; border-radius:16px; padding:12px 14px; box-shadow:0 4px 10px rgba(0,0,0,.06)}
  @media(min-width:760px){ .grid{grid-template-columns:1fr 1fr}}

  #intro{font-size:1.05rem; color:#444; margin:6px 0 14px; line-height:1.6; font-style:italic; opacity:.9}

  #advice{min-height:1.6em; font-weight:700; transition:opacity .25s ease, transform .25s ease}
  .fade-in{opacity:1; transform:translateY(0)}
  .fade-out{opacity:0; transform:translateY(4px)}
  .footer{margin-top:10px; font-size:.85rem; color:#666}

  /* íŒŒí‹°í´ */
  .particle{
    position:absolute; pointer-events:none; user-select:none; font-size:1.4rem; will-change:transform, opacity;
    animation: rise 800ms ease-out forwards;
    filter: drop-shadow(0 2px 2px rgba(0,0,0,.15));
  }
  @keyframes rise{
    0%{transform:translate(0,0) scale(1); opacity:1}
    100%{transform:translate(var(--dx, 10px), var(--dy, -60px)) scale(0.8); opacity:0}
  }
</style>
</head>
<body>
  <div class="stars" aria-hidden="true" id="stars"></div>

  <div class="app">
    <header>
      <div style="text-align:left">
        <h1>ğŸ± í•´ê²°ëƒ¥ëƒ¥ì´ ê³ ì–‘ì¹˜</h1>
        <div class="sub">ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥! ê°™ì€ ê¸°ê¸°/ë¸Œë¼ìš°ì €ì—ì„œ ì´ì–´ì„œ ë†€ ìˆ˜ ìˆì–´ìš”.</div>
      </div>
      <div class="ctrls">
        <select id="skinSelect" title="ìŠ¤í‚¨ ì„ íƒ">
          <option value="emoji">ìŠ¤í‚¨: ì´ëª¨ì§€</option>
          <option value="simple">ìŠ¤í‚¨: ì‹¬í”Œ ê³ ì–‘ì´</option>
          <option value="chonky">ìŠ¤í‚¨: í†µí†µ ê³ ì–‘ì´</option>
        </select>
        <select id="themeSelect" title="í…Œë§ˆ ì„ íƒ">
          <option value="auto">í…Œë§ˆ: ìë™</option>
          <option value="day">í…Œë§ˆ: ì£¼ê°„</option>
          <option value="night">í…Œë§ˆ: ì•¼ê°„</option>
        </select>
        <div id="soundChip" class="chip active" role="button" aria-pressed="true">ğŸ”Š ì‚¬ìš´ë“œ ON</div>
      </div>
    </header>

    <p id="intro">
      ë§ˆìŒì†ìœ¼ë¡œ ê³ ë¯¼ì´ë‚˜ ì§ˆë¬¸ì„ ë– ì˜¬ë¦° ë’¤,<br>
      ì²œì²œíˆ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.<br><br>
      ğŸ“– ì‹ ë¹„ë¡œìš´ í•´ê²° ëƒ¥ëƒ¥ì´ê°€<br>
      ì˜¤ëŠ˜ì˜ ì¡°ì–¸ì„ ì „í•´ë“œë¦½ë‹ˆë‹¤â€¦ âœ¨
    </p>

    <div class="pet">
      <div class="avatar" id="avatar">
        <div class="face" id="face">ğŸ˜º</div>
      </div>
      <div>
        <div class="name" id="petName">ëƒ¥ëƒ¥ì´</div>
        <div class="hint" id="statusLine">ê¸°ë¶„ ì¢‹ì€ ê°€ë¥´ë‘ ì†Œë¦¬ê°€ ë“¤ë ¤ìš” ğŸ˜º</div>
      </div>
    </div>

    <div class="bars">
      <div class="bar">
        <div>ë°°ê³ í””</div>
        <div class="track"><div class="fill" id="barHunger"></div></div>
        <div class="val" id="valHunger">60</div>
      </div>
      <div class="bar">
        <div>í–‰ë³µ</div>
        <div class="track"><div class="fill" id="barHappy"></div></div>
        <div class="val" id="valHappy">60</div>
      </div>
      <div class="bar">
        <div>ì—ë„ˆì§€</div>
        <div class="track"><div class="fill" id="barEnergy"></div></div>
        <div class="val" id="valEnergy">60</div>
      </div>
      <div class="bar">
        <div>ë ˆë²¨</div>
        <div class="track"><div class="fill" id="barXP" style="background:linear-gradient(90deg,#6dd5ed,#2193b0)"></div></div>
        <div class="val" id="valLevel">Lv 1</div>
      </div>
    </div>

    <div class="row">
      <button onclick="feed()">ğŸš ë°¥ ì£¼ê¸°</button>
      <button class="pill" onclick="play()">ğŸ¾ ë†€ì•„ì£¼ê¸°</button>
      <button class="warn" onclick="sleep()">ğŸ›ï¸ ì¬ìš°ê¸°</button>
      <button class="small" onclick="renamePet()">âœï¸ ì´ë¦„</button>
      <button class="small" onclick="drawAdvice()">ğŸ“– ì¡°ì–¸</button>
    </div>

    <div class="grid">
      <div class="card">
        <div class="hint">ì¡°ì–¸ì€ ì¤‘ë³µ ì—†ì´ ëœë¤ìœ¼ë¡œ ë‚˜ì™€ìš”. ëª¨ë‘ ì†Œì§„ë˜ë©´ ë‹¤ì‹œ ì„ì–´ìš”.</div>
        <div id="advice" class="fade-in" style="margin-top:8px;"></div>
      </div>
      <div class="card">
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center">
          <button class="small" onclick="resetPet()">ğŸ”„ ì´ˆê¸°í™”</button>
          <button class="small" onclick="exportSave()">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
          <button class="small" onclick="importSave()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
        <textarea id="saveArea" placeholder="ë‚´ë³´ë‚´ê¸°í•˜ë©´ ì €ì¥ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë¼ìš”. ë¶ˆëŸ¬ì˜¤ê¸°ëŠ” ì—¬ê¸°ì— ë¶™ì—¬ë„£ê³  ì‹¤í–‰!"></textarea>
      </div>
    </div>

    <div class="footer">ì €ì¥ì€ ì´ ê¸°ê¸°/ë¸Œë¼ìš°ì €ì—ë§Œ ìœ ì§€ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ê³³ì—ì„œë„ ì´ì–´í•˜ë ¤ë©´ ë‚´ë³´ë‚´ê¸°/ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</div>
  </div>

<script>
/* ===================== ì €ì¥/ìƒíƒœ ===================== */
const STORAGE_KEY = "nyang_tama_v3";
const defaultState = () => ({
  name: "ëƒ¥ëƒ¥ì´",
  hunger: 60, happy: 60, energy: 60,
  xp: 0, level: 1,
  last: Date.now(),
  advicePool: [],
  settings: { skin:"emoji", theme:"auto", sound:true }
});
let S = load();
function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return defaultState();
    const obj = JSON.parse(raw);
    return { ...defaultState(), ...obj, settings:{...defaultState().settings, ...(obj.settings||{})}};
  }catch(e){ return defaultState(); }
}
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(S)); }

/* ===================== ì‹œê°„ ê²½ê³¼(ì˜¤í”„ë¼ì¸) ===================== */
function applyTimeDecay(){
  const now = Date.now();
  const dtMin = Math.floor((now - (S.last||now))/60000);
  if(dtMin>0){
    const steps = Math.floor(dtMin/10); // 10ë¶„ë§ˆë‹¤ 1ì”© ê°ì†Œ
    if(steps>0){
      change("hunger",-steps);
      change("happy",-steps);
      change("energy",-steps);
    }
    S.last = now; save();
  }
}

/* ===================== ìœ í‹¸/ì‚¬ìš´ë“œ ===================== */
function clamp(v){ return Math.max(0, Math.min(100, v)); }
function change(k, dv){ S[k] = clamp((S[k]??0) + dv); }
function avgStat(){ return (S.hunger+S.happy+S.energy)/3; }
function stage(){ return S.level>=10 ? "boss" : S.level>=5 ? "adult" : "kitten"; }

function gainXP(n=6){
  S.xp += n;
  while(S.xp>=100){
    S.xp-=100; S.level++;
    toast(`ë ˆë²¨ ì—…! ğŸ‰ Lv ${S.level}`); playTone([880,1175,1568], 0.06);
  }
}

/* ---- WebAudio: beep + purr(ê·¸ë¥´ë¦‰) ---- */
let AC, masterGain, purrNode=null, purrGain=null;
function ensureAudio(){
  if(!S.settings.sound) return;
  if(!AC){
    AC = new (window.AudioContext||window.webkitAudioContext)();
    masterGain = AC.createGain(); masterGain.gain.value=0.16; masterGain.connect(AC.destination);
  }
}
function beep(freq=440, dur=0.12){
  if(!S.settings.sound) return;
  ensureAudio();
  const o=AC.createOscillator(), g=AC.createGain();
  o.type="sine"; o.frequency.value=freq;
  g.gain.value=0.0001; o.connect(g); g.connect(masterGain);
  const now=AC.currentTime;
  g.gain.setValueAtTime(0.0001, now);
  g.gain.linearRampToValueAtTime(0.5, now+dur*0.15);
  g.gain.exponentialRampToValueAtTime(0.0001, now+dur);
  o.start(now); o.stop(now+dur);
}
function playTone(freqs=[660,550,440], step=0.1){
  let t=0;
  freqs.forEach(f=>{ setTimeout(()=>beep(f, step), t*1000); t+=step*0.9; });
}
function startPurr(){
  if(!S.settings.sound) return;
  ensureAudio();
  if(purrNode) return; // already
  // ì €ì£¼íŒŒ í†¤ + ì§„í­ ë³€ì¡°ë¡œ ê·¸ë¥´ë¦‰ êµ¬í˜„
  const osc = AC.createOscillator(); // base rumble
  osc.type = "triangle"; osc.frequency.value = 45; // ì €ì£¼íŒŒ
  const lfo = AC.createOscillator(); // ì‚¬ì´ë“œ LFO
  lfo.type = "sine"; lfo.frequency.value = 23;

  const g = AC.createGain(); g.gain.value = 0.0; // ì‹œì‘ 0
  const lfoGain = AC.createGain(); lfoGain.gain.value = 0.35; // ë–¨ë¦¼ ê¹Šì´
  lfo.connect(lfoGain); lfoGain.connect(g.gain);
  osc.connect(g); g.connect(masterGain);

  const now = AC.currentTime;
  g.gain.setValueAtTime(0.0, now);
  g.gain.linearRampToValueAtTime(0.2, now+0.25);

  osc.start(); lfo.start();
  purrNode = {osc,lfo}; purrGain = g;
}
function stopPurr(){
  if(!purrNode) return;
  const now = AC.currentTime;
  try{
    purrGain.gain.cancelScheduledValues(now);
    purrGain.gain.linearRampToValueAtTime(0.0001, now+0.2);
    setTimeout(()=>{
      try{ purrNode.osc.stop(); purrNode.lfo.stop(); }catch(_){}
      purrNode=null; purrGain=null;
    }, 220);
  }catch(_){ purrNode=null; purrGain=null; }
}

/* ===================== ì•¡ì…˜ ===================== */
function feed(){
  applyTimeDecay();
  change("hunger", +22); change("happy", +5); change("energy", +2); gainXP(6);
  setStatus("ë§›ìˆëŠ” ë°¥ ëƒ ëƒ ! ğŸš"); playTone([523,659,784],0.09);
  spawnParticles("ğŸš â¤ï¸", 10);
  render(); save();
}
function play(){
  applyTimeDecay();
  change("happy", +16); change("energy", -8); change("hunger", -6); gainXP(8);
  setStatus("ê³µì„ í”ë“¤ë©° ì‹ ë‚˜ê²Œ ë†€ì•„ìš” ğŸ¾"); playTone([784,880,988],0.08);
  spawnParticles("âœ¨ â­ï¸ ğŸ’«", 12);
  render(); save();
}
function sleep(){
  applyTimeDecay();
  change("energy", +24); change("hunger", -8); gainXP(4);
  setStatus("í¬ê·¼í•œ ë‚®ì ì„ ìëŠ” ì¤‘ì´ì—ìš” ğŸ’¤"); playTone([392,329,261],0.12);
  spawnParticles("ğŸ’¤ ğŸŒ™", 8);
  render(); save();
}
function renamePet(){
  const name = prompt("ê³ ì–‘ì´ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”", S.name||"ëƒ¥ëƒ¥ì´");
  if(name && name.trim()){
    S.name = name.trim();
    setStatus(`ì´ë¦„ì´ '${S.name}'(ìœ¼)ë¡œ ë°”ë€Œì—ˆì–´ìš” âœï¸`);
    render(); save();
  }
}
function resetPet(){
  if(confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”? ì €ì¥ëœ ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤.")){
    S = defaultState();
    setStatus("ìƒˆë¡œìš´ ëª¨í—˜ì„ ì‹œì‘í•´ìš” âœ¨");
    render(); save();
  }
}
function exportSave(){
  document.getElementById("saveArea").value = JSON.stringify(S);
  toast("ì €ì¥ ë°ì´í„°ë¥¼ ë‚´ë³´ëƒˆì–´ìš” ğŸ’¾");
}
function importSave(){
  try{
    const t=document.getElementById("saveArea").value.trim();
    if(!t) return alert("ë¶ˆëŸ¬ì˜¬ JSONì„ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.");
    const obj=JSON.parse(t);
    S = { ...defaultState(), ...obj, settings:{...defaultState().settings, ...(obj.settings||{})}};
    setStatus("ì €ì¥ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ì–´ìš” ğŸ“‚");
    render(); save();
  }catch(e){ alert("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ì˜¬ë°”ë¥¸ JSONì´ ì•„ë‹ˆì—ìš”."); }
}

/* ===================== ì¡°ì–¸(ë¹„ë³µì› ëœë¤) ===================== */
const advices = [
  "ë§ˆìŒì†ìœ¼ë¡œ ê³ ë¯¼ì„ ì‚´ì§ ì˜¬ë ¤ë‘ê³ , ìˆ¨ì„ í•œ ë²ˆ ê³ ë¥´ì„¸ìš”.",
  "ì˜¤ëŠ˜ì€ ë‹µì„ ì°¾ê¸°ë³´ë‹¤, ìŠ¤ìŠ¤ë¡œì—ê²Œ ì‘ì€ íœ´ì‹ì„ ì„ ë¬¼í•˜ì„¸ìš”.",
  "ê¸¸ì„ ìƒì€ ê²ƒ ê°™ì•„ë„, ê·¸ ê¸¸ ìœ„ì—ì„œ ë°°ìš°ëŠ” ê²Œ ìˆìŠµë‹ˆë‹¤.",
  "ë¬¸ì œëŠ” ìƒê°ë³´ë‹¤ ë‹¨ìˆœí•  ìˆ˜ ìˆì–´ìš”. ë§ˆìŒì„ ê°€ë³ê²Œ í•´ë³´ì„¸ìš”.",
  "ë‹¹ì‹ ì´ ë‚´ë”›ëŠ” ì‘ì€ ë°œê±¸ìŒì´ ë‚´ì¼ì˜ í° ìš©ê¸°ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
  "ì„œë‘ë¥´ì§€ ì•Šì•„ë„ ê´œì°®ìŠµë‹ˆë‹¤. ê¸°ë‹¤ë¦¼ì´ ê°€ì¥ ë¹ ë¥¸ ê¸¸ì´ ë  ë•Œê°€ ìˆì–´ìš”.",
  "ê³ ì–‘ì´ì²˜ëŸ¼ ìœ ì—°í•˜ê²Œ, ìƒí™©ì— ëª¸ì„ ë§¡ê²¨ë³´ì„¸ìš”.",
  "ì™¸ë¡œì›€ ì†ì—ì„œë„ ëˆ„êµ°ê°€ëŠ” ë‹¹ì‹ ì„ ì‘ì›í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
  "ì„ íƒì´ ì–´ë µë‹¤ë©´, ì§€ê¸ˆ ë§ˆìŒì´ ê°€ì¥ í¸ì•ˆí•´ì§€ëŠ” ìª½ì„ íƒí•˜ì„¸ìš”.",
  "ê³ ê°œë¥¼ ë“¤ì–´ í•˜ëŠ˜ì„ ë°”ë¼ë³´ì„¸ìš”. ë‹µì€ ê°€ê¹Œìš´ ê³³ì— ìˆì–´ìš”.",
  "ì§€ê¸ˆì˜ ê³ ë¯¼ì€ ì–¸ì  ê°€ ì›ƒìœ¼ë©° ì´ì•¼ê¸°í•  ì¶”ì–µì´ ë©ë‹ˆë‹¤.",
  "ì™„ë²½í•  í•„ìš” ì—†ì–´ìš”. ì§€ê¸ˆì˜ ë‹¹ì‹  ê·¸ëŒ€ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.",
  "í•œ ê±¸ìŒ ë¬¼ëŸ¬ì„œë©´ ìƒˆë¡œìš´ í’ê²½ì´ ë³´ì¼ ê±°ì˜ˆìš”.",
  "ì‹¤íŒ¨ëŠ” ëì´ ì•„ë‹ˆë¼, ë” ë‚˜ì€ ë°©ë²•ì„ ì•Œë ¤ì£¼ëŠ” ì•ˆë‚´ì„œëë‹ˆë‹¤.",
  "ì§€ê¸ˆì€ ë©ˆì¶°ë„ ê´œì°®ì•„ìš”. ê³ ì–‘ì´ë„ ë‚®ì ì´ í•„ìš”í•˜ë‹ˆê¹Œìš”.",
  "ìš©ê¸°ê°€ í¬ì§€ ì•Šì•„ë„ ë¼ìš”. ì•„ì£¼ ì‘ì€ ìš©ê¸° í•˜ë‚˜ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.",
  "ì›ƒìŒì„ ìƒì§€ ì•ŠëŠ”ë‹¤ë©´, ì–´ë–¤ ì–´ë ¤ì›€ë„ ì§€ë‚˜ê°ˆ ê±°ì˜ˆìš”.",
  "ì† ë‚´ë°€ë©´ ë„ì›€ì€ ì˜ì™¸ë¡œ ê°€ê¹Œì´ ìˆìŠµë‹ˆë‹¤.",
  "ê³ ì–‘ì´ ë°œìêµ­ì²˜ëŸ¼, ë‹¹ì‹ ì˜ í”ì ë„ ëˆ„êµ°ê°€ì—ê²Œ ìœ„ë¡œê°€ ë©ë‹ˆë‹¤.",
  "ë‹µì„ ì •í•˜ë ¤ ì• ì“°ì§€ ë§ê³ , ë‹µì´ ìŠ¤ìŠ¤ë¡œ ë‹¤ê°€ì˜¤ë„ë¡ ê¸°ë‹¤ë ¤ë³´ì„¸ìš”.",
  "ê²°êµ­ ëª¨ë“  ê²ƒì€ ì˜ í˜ëŸ¬ê°€ê³ , ë‹¹ì‹ ì€ ì›ƒê²Œ ë  ê±°ì˜ˆìš”.",
  "ë§ˆìŒì„ ë‹¤ì¡ëŠ” ë°ëŠ” ê¸´ ì‹œê°„ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
  "ì§€ê¸ˆì˜ ê³ ìš”ê°€ ë‚´ì¼ì˜ í˜ì´ ë©ë‹ˆë‹¤.",
  "ê´œì°®ë‹¤ê³  ìŠ¤ìŠ¤ë¡œì—ê²Œ ë§í•´ë³´ì„¸ìš”. ìƒê°ë³´ë‹¤ í° ìœ„ë¡œê°€ ë©ë‹ˆë‹¤.",
  "ë†“ì•„ì•¼ í•  ë•ŒëŠ” ì†ì„ ë†“ëŠ” ê²ƒë„ ì§€í˜œì…ë‹ˆë‹¤.",
  "í•´ë‹µì€ ë©€ë¦¬ ìˆì§€ ì•Šê³ , ì´ë¯¸ ë‹¹ì‹  ì•ˆì— ìˆìŠµë‹ˆë‹¤.",
  "ìƒˆë²½ì€ ì–¸ì œë‚˜ ì–´ë‘  ë’¤ì— ì°¾ì•„ì˜µë‹ˆë‹¤.",
  "ì˜¤ëŠ˜ì˜ ê³ ë¯¼ì€ ë‚´ì¼ì˜ ì§€í˜œê°€ ë©ë‹ˆë‹¤.",
  "ë‹¤ê°€ì˜¬ ì¼ì„ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆì„¸ìš”. ì¤€ë¹„ë˜ì§€ ì•Šì•„ë„ ê´œì°®ìŠµë‹ˆë‹¤.",
  "í•œ ë²ˆì˜ ë©ˆì¶¤ì€ ì‹¤íŒ¨ê°€ ì•„ë‹ˆë¼ ì¶©ì „ì…ë‹ˆë‹¤.",
  "ì‘ì€ ê¸°ì¨ì´ í° ìŠ¬í””ì„ ì´ê¹ë‹ˆë‹¤.",
  "ì˜¤ëŠ˜ì˜ ì„ íƒì´ ë‚´ì¼ì˜ ê¸°ì ì„ ë§Œë“­ë‹ˆë‹¤.",
  "ê¸°ëŒ€í•˜ì§€ ì•Šì•˜ë˜ ê³³ì—ì„œ ê¸¸ì´ ì—´ë¦½ë‹ˆë‹¤.",
  "í˜¼ìê°€ ì•„ë‹ˆì—ìš”. ë‹¹ì‹ ì„ ìƒê°í•˜ëŠ” ì´ê°€ ìˆìŠµë‹ˆë‹¤.",
  "ë‹µì´ ë³´ì´ì§€ ì•Šì„ ë•, ì ì‹œ ëˆˆì„ ê°ì•„ë³´ì„¸ìš”.",
  "ì§€ê¸ˆì˜ ë‹¹ì‹ ì€ ì¶©ë¶„íˆ ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
  "ë§ˆìŒì´ í”ë“¤ë¦´ ë•, ì ì‹œ ë°”ëŒì— ëª¸ì„ ë§¡ê¸°ì„¸ìš”.",
  "ë‹µì€ ì„ ëª…í•˜ì§€ ì•Šì•„ë„, ë°©í–¥ì€ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤.",
  "ê°€ë”ì€ ëª¨ë¥´ëŠ” ì±„ë¡œ ë‘ëŠ” ê²ƒë„ ë°©ë²•ì…ë‹ˆë‹¤.",
  "í˜ë“¤ìˆ˜ë¡ ì‘ì€ ì¦ê±°ì›€ì„ ì°¾ì•„ë³´ì„¸ìš”.",
  "ë‹µì´ ëŠ¦ê²Œ ì˜¤ëŠ” ê±´, ë” ì¢‹ì€ ê¸¸ì„ ì¤€ë¹„í•˜ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.",
  "ì§€ê¸ˆ ëŠë¼ëŠ” í˜¼ë€ë„ ì–¸ì  ê°€ ì •ë¦¬ë©ë‹ˆë‹¤.",
  "ê³ í†µì€ ì ì‹œì§€ë§Œ, ë°°ì›€ì€ ì˜¤ë˜ ë‚¨ìŠµë‹ˆë‹¤.",
  "í¬ê¸°í•˜ê³  ì‹¶ì„ ë•Œê°€ ê³§ ë³€ê³¡ì ì…ë‹ˆë‹¤.",
  "ë‹¹ì‹ ì´ ì›í•˜ëŠ” ì‚¶ì€ ì´ë¯¸ ë‹¹ì‹ ì„ í–¥í•´ ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.",
  "ë‹µì€ ë‹¹ì‹ ì˜ ì¼ìƒ ì†ì— ìˆ¨ì–´ ìˆìŠµë‹ˆë‹¤.",
  "ì›ƒìŒì€ ëª¨ë“  ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ëŠ” ì•½ì…ë‹ˆë‹¤.",
  "ì²œì²œíˆ ê°€ë„ ê´œì°®ìŠµë‹ˆë‹¤. ê²°êµ­ ë„ì°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
  "ë‹¹ì‹ ì´ ê°€ì§„ ì¹œì ˆì€ ë°˜ë“œì‹œ ëŒì•„ì˜µë‹ˆë‹¤.",
  "ì˜¤ëŠ˜ì˜ í•œìˆ¨ì€ ë‚´ì¼ì˜ ì›ƒìŒì´ ë©ë‹ˆë‹¤."
];
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
function drawAdvice(){
  if(!Array.isArray(S.advicePool) || S.advicePool.length===0){ S.advicePool = shuffle([...advices]); }
  const msg = S.advicePool.pop();
  const box = document.getElementById("advice");
  box.classList.remove("fade-in"); box.classList.add("fade-out");
  setTimeout(()=>{ box.textContent = "ğŸ¾ " + msg; box.classList.remove("fade-out"); box.classList.add("fade-in"); }, 120);
  save(); if(S.settings.sound){ beep(520,0.08); }
}

/* ===================== ë Œë”/UI & ì•„íŠ¸ ===================== */
function setBar(id, val){ document.getElementById(id).style.width = clamp(val) + "%"; }
function setStatus(t){ document.getElementById("statusLine").textContent = t; }
function moodFaceEmoji(){
  const a = avgStat();
  if(a>=85) return "ğŸ˜»"; if(a>=65) return "ğŸ˜º"; if(a>=45) return "ğŸ˜¼"; if(a>=25) return "ğŸ˜¿"; return "ğŸ˜¾";
}
function renderBars(){
  document.getElementById("valHunger").textContent=S.hunger;
  document.getElementById("valHappy").textContent=S.happy;
  document.getElementById("valEnergy").textContent=S.energy;
  document.getElementById("valLevel").textContent=`Lv ${S.level}`;
  setBar("barHunger",S.hunger); setBar("barHappy",S.happy); setBar("barEnergy",S.energy); setBar("barXP",S.xp%100);

  const a = avgStat();
  if(a>=75) setStatus("ë°˜ì§ì´ëŠ” ëˆˆìœ¼ë¡œ ë‹¹ì‹ ì„ ë°”ë¼ë´…ë‹ˆë‹¤ âœ¨");
  else if(a>=55) setStatus("ê¸°ë¶„ ì¢‹ì€ ê°€ë¥´ë‘ ì†Œë¦¬ê°€ ë“¤ë ¤ìš” ğŸ˜º");
  else if(a>=35) setStatus("ì‚´ì§ ì‹œë¬´ë£©í•´ìš”â€¦ ì“°ë‹´ì“°ë‹´ì´ í•„ìš”í•´ìš” ğŸŒ¥ï¸");
  else setStatus("ë°°ê³ í”„ê³  ì§€ì¹œ í‘œì •ì´ì—ìš”â€¦ ëŒë´„ì´ í•„ìš”í•´ìš” ğŸŒ§ï¸");

  // Purr ìë™ ì œì–´
  if(S.settings.sound && a>=60) startPurr(); else stopPurr();
}
function computedTheme(){
  if(S.settings.theme==="day") return "day";
  if(S.settings.theme==="night") return "night";
  const h = new Date().getHours(); return (h>=19 || h<6) ? "night" : "day";
}
function renderTheme(){
  const isNight = computedTheme()==="night";
  document.body.classList.toggle("is-night", isNight);
  document.body.style.background = isNight
    ? `linear-gradient(135deg, var(--night1), var(--night2))`
    : `linear-gradient(135deg, var(--day1), var(--day2))`;
}
function renderStars(){
  const cont = document.getElementById("stars"); cont.innerHTML="";
  if(computedTheme()!=="night") return;
  const N = 90;
  for(let i=0;i<N;i++){
    const s=document.createElement("div"); s.className="star";
    s.style.left = Math.random()*100+"%"; s.style.top  = Math.random()*100+"%";
    s.style.opacity = (0.4+Math.random()*0.6).toFixed(2);
    s.style.transform = `scale(${0.8+Math.random()*1.8})`;
    cont.appendChild(s);
  }
}
/* ìŠ¤í‚¨ë³„ SVG: ë‚®/ë°¤/ì„±ì¥(kitten/adult/boss) ìƒ‰ìƒ ë³€í™” */
function svgSimple(colorBase, colorEar, mouthY){
  return `
  <svg class="svgcat" viewBox="0 0 120 120" aria-label="cat simple">
    <circle cx="60" cy="65" r="36" fill="${colorBase}" stroke="#333" stroke-width="3"/>
    <path d="M34 42 L20 20 L44 30 Z" fill="${colorEar}" stroke="#333" stroke-width="3"/>
    <path d="M86 42 L100 20 L76 30 Z" fill="${colorEar}" stroke="#333" stroke-width="3"/>
    <circle cx="48" cy="66" r="4" fill="#333"/>
    <circle cx="72" cy="66" r="4" fill="#333"/>
    <circle cx="60" cy="${mouthY}" r="3" fill="#ff5a7a"/>
    <path d="M45 84 Q60 92 75 84" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
    <path d="M60 ${mouthY} L52 ${mouthY} M60 ${mouthY} L68 ${mouthY}" stroke="#333" stroke-width="2" stroke-linecap="round"/>
  </svg>`;
}
function svgChonky(colorBody, colorHead, moodCurve){
  return `
  <svg class="svgcat" viewBox="0 0 120 120" aria-label="cat chonky">
    <ellipse cx="60" cy="74" rx="40" ry="34" fill="${colorBody}" stroke="#333" stroke-width="3"/>
    <circle cx="60" cy="55" r="22" fill="${colorHead}" stroke="#333" stroke-width="3"/>
    <path d="M43 46 L30 30 L50 36 Z" fill="${colorHead}" stroke="#333" stroke-width="3"/>
    <path d="M77 46 L90 30 L70 36 Z" fill="${colorHead}" stroke="#333" stroke-width="3"/>
    <circle cx="52" cy="56" r="3.5" fill="#333"/>
    <circle cx="68" cy="56" r="3.5" fill="#333"/>
    <path d="${moodCurve}" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
    <circle cx="60" cy="62" r="3" fill="#ff7b54"/>
    <path d="M60 62 L53 62 M60 62 L67 62" stroke="#333" stroke-width="2" stroke-linecap="round"/>
  </svg>`;
}
function renderAvatar(){
  const wrap = document.getElementById("avatar");
  wrap.innerHTML = "";
  const theme = computedTheme();
  const stg = stage();
  if(S.settings.skin==="emoji"){
    const d=document.createElement("div"); d.className="face"; d.id="face"; d.textContent=moodFaceEmoji();
    wrap.appendChild(d);
    return;
  }
  if(S.settings.skin==="simple"){
    // ìƒ‰ìƒ: ë‚®/ë°¤/ì„±ì¥
    const baseDay = stg==="kitten" ? "#FFD6E7" : stg==="adult" ? "#FFE6A7" : "#C4F1BE";
    const baseNight = stg==="kitten" ? "#DFAFD0" : stg==="adult" ? "#E2CF8A" : "#A7E0A4";
    const earDay = "#fff"; const earNight="#eee";
    const colorBase = theme==="night" ? baseNight : baseDay;
    const colorEar  = theme==="night" ? earNight  : earDay;
    const mouthY = 76 + (avgStat()<45 ? 2 : 0);
    wrap.innerHTML = svgSimple(colorBase, colorEar, mouthY);
    return;
  }
  // chonky
  const bodyDay = stg==="kitten" ? "#FFE9B3" : stg==="adult" ? "#BEE3F8" : "#C6F6D5";
  const headDay = stg==="kitten" ? "#FFE9B3" : stg==="adult" ? "#90CDF4" : "#9AE6B4";
  const bodyNight= stg==="kitten" ? "#E8D39A" : stg==="adult" ? "#8CB8E0" : "#99D9B6";
  const headNight= stg==="kitten" ? "#E8D39A" : stg==="adult" ? "#7AA7D3" : "#82CAA5";
  const isNight = theme==="night";
  const curveHappy = "M52 66 Q60 72 68 66";
  const curveFlat  = "M52 68 Q60 68 68 68";
  const moodCurve = avgStat()>=60 ? curveHappy : curveFlat;
  wrap.innerHTML = svgChonky(isNight?bodyNight:bodyDay, isNight?headNight:headDay, moodCurve);
}

function renderThemeAndStars(){ renderTheme(); renderStars(); }

/* ===================== íŒŒí‹°í´ ===================== */
function spawnParticles(chars="âœ¨", count=10){
  const avatar = document.getElementById("avatar");
  const rect = avatar.getBoundingClientRect();
  for(let i=0;i<count;i++){
    const p = document.createElement("div");
    p.className="particle";
    const arr = chars.split(" ").filter(Boolean);
    p.textContent = arr[Math.floor(Math.random()*arr.length)];
    const x = rect.left + rect.width/2 + (Math.random()*30-15);
    const y = rect.top  + rect.height/2 + (Math.random()*10-5);
    p.style.left = x+"px";
    p.style.top  = y+"px";
    const dx = (Math.random()*80-40)+"px";
    const dy = (-60 - Math.random()*40)+"px";
    p.style.setProperty("--dx", dx);
    p.style.setProperty("--dy", dy);
    document.body.appendChild(p);
    setTimeout(()=>p.remove(), 900);
  }
}

/* ===================== ì´ë²¤íŠ¸/ì„¤ì • ë°”ì¸ë”© ===================== */
document.getElementById("skinSelect").value = S.settings.skin;
document.getElementById("themeSelect").value = S.settings.theme;
document.getElementById("skinSelect").addEventListener("change", e=>{
  S.settings.skin = e.target.value; renderAvatar(); save();
});
document.getElementById("themeSelect").addEventListener("change", e=>{
  S.settings.theme = e.target.value; renderThemeAndStars(); renderAvatar(); save();
});
const soundChip = document.getElementById("soundChip");
function updateSoundChip(){
  soundChip.classList.toggle("active", !!S.settings.sound);
  soundChip.textContent = S.settings.sound ? "ğŸ”Š ì‚¬ìš´ë“œ ON" : "ğŸ”‡ ì‚¬ìš´ë“œ OFF";
  soundChip.setAttribute("aria-pressed", S.settings.sound ? "true":"false");
  if(!S.settings.sound) stopPurr(); else { /* í´ë¦­ ì¦‰ì‹œ í™•ì¸ìš© */ ensureAudio(); beep(660,0.08); }
}
soundChip.addEventListener("click", ()=>{
  S.settings.sound = !S.settings.sound;
  updateSoundChip(); save();
});

/* ===================== ê³µìš© ë Œë” & ì´ˆê¸°í™” ===================== */
function render(){
  document.getElementById("petName").textContent = S.name || "ëƒ¥ëƒ¥ì´";
  const faceEl = document.getElementById("face");
  if(faceEl) faceEl.textContent = moodFaceEmoji();
  renderBars(); renderThemeAndStars(); renderAvatar(); updateSoundChip();
}
function tick(){ applyTimeDecay(); render(); save(); }

/* í† ìŠ¤íŠ¸ */
let toastTimer=null;
function toast(msg){
  const t=document.createElement("div");
  t.textContent = msg;
  t.style.position="fixed"; t.style.left="50%"; t.style.bottom="24px"; t.style.transform="translateX(-50%)";
  t.style.background="#111"; t.style.color="#fff"; t.style.padding="10px 14px"; t.style.borderRadius="999px";
  t.style.boxShadow="0 8px 18px rgba(0,0,0,.25)"; t.style.fontSize=".95rem"; t.style.zIndex=9999; t.style.opacity="0";
  document.body.appendChild(t);
  requestAnimationFrame(()=>{ t.style.transition="opacity .25s ease, transform .25s ease"; t.style.opacity="1"; t.style.transform="translateX(-50%) translateY(-4px)";});
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>{ t.style.opacity="0"; t.style.transform="translateX(-50%) translateY(0)"; setTimeout(()=>t.remove(),250); },1700);
}

/* ì´ˆê¸° ì‹¤í–‰ */
applyTimeDecay();
render();
setInterval(tick, 15000);
</script>
</body>
</html>
